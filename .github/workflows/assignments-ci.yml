name: Assignments CI

on:
  push:
    branches: [ main, master, develop ]
    paths:
      - 'Assignments/**'
      - '.github/workflows/assignments-ci.yml'
  pull_request:
    branches: [ main, master, develop ]
    paths:
      - 'Assignments/**'
      - '.github/workflows/assignments-ci.yml'

jobs:
  validate-assignments:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        problem-set: [1, 2, 3, 4]
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest numpy pandas scikit-learn matplotlib seaborn jupyter nbconvert flake8
    
    - name: Lint Python files
      run: |
        cd Assignments/Problem_Set_${{ matrix.problem-set }}
        if [ -d "scripts" ]; then
          flake8 scripts/ --count --select=E9,F63,F7,F82 --show-source --statistics || true
        fi
        if [ -d "tests" ]; then
          flake8 tests/ --count --select=E9,F63,F7,F82 --show-source --statistics || true
        fi
    
    - name: Run unit tests
      run: |
        cd Assignments/Problem_Set_${{ matrix.problem-set }}
        if [ -d "tests" ]; then
          pytest tests/ -v
        else
          echo "No tests directory found for Problem Set ${{ matrix.problem-set }}"
        fi
    
    - name: Validate student notebook execution
      run: |
        cd Assignments/Problem_Set_${{ matrix.problem-set }}
        if [ -f "notebooks/problem_set_${{ matrix.problem-set }}_student.ipynb" ]; then
          jupyter nbconvert --to notebook --execute notebooks/problem_set_${{ matrix.problem-set }}_student.ipynb --output /tmp/student_executed.ipynb
        else
          echo "No student notebook found for Problem Set ${{ matrix.problem-set }}"
        fi
    
    - name: Validate solution notebook execution
      run: |
        cd Assignments/Problem_Set_${{ matrix.problem-set }}
        if [ -f "notebooks/problem_set_${{ matrix.problem-set }}_solution.ipynb" ]; then
          jupyter nbconvert --to notebook --execute notebooks/problem_set_${{ matrix.problem-set }}_solution.ipynb --output /tmp/solution_executed.ipynb
        else
          echo "No solution notebook found for Problem Set ${{ matrix.problem-set }}"
        fi
    
    - name: Run autograder in dry-run mode
      run: |
        cd Assignments/Problem_Set_${{ matrix.problem-set }}
        if [ -f "scripts/autograde.py" ]; then
          python scripts/autograde.py --dry-run || true
        else
          echo "No autograder found for Problem Set ${{ matrix.problem-set }}"
        fi

# Made By Ritesh Rana
